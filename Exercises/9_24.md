# Exercise 9.24

Verify the relation
$$
\log(p(X|\theta)) = \mathcal{L}(q, \theta) + \text{KL}(q||p) \tag{9.70}
$$
in which $\mathcal{L}(q, \theta)$ and $\text{KL}(q||p)$ are defined by
$$
\mathcal{L}(q, \theta) = \sum_Z q(Z) \log\left(\frac{p(X, Z|\theta)}{q(Z)}\right) \tag{9.71}
$$
and
$$
\text{KL}(q||p) = -\sum_Z q(Z) \log\left(\frac{p(Z|X, \theta)}{q(Z)}\right) \tag{9.72}
$$
respectively.

## Solution
Recall that
$$
\log(ab) = \log(a) + \log(b) \tag{1}
$$
and
$$
\log(a^{-1}) = -\log(a) \tag{2}
$$
hold.

Let $q(Z)$ be any distribution then by definition
$$
\sum_Z q(Z) = 1 \tag{3}.
$$

We can compute
$$
\begin{aligned}
\log(p(X|\theta)) &\overset{3}{=} \sum_Z q(Z) \log(p(X|\theta)) \\
&= \sum_Z q(Z)\log\left(\frac{p(X, \theta)}{p(\theta)}\right) \\
&= \sum_Z q(Z)\log\left(\frac{\color{red}p(X, Z, \theta)\color{black}}{p(\theta)} \frac{p(X, \theta)}{\color{red}p(X, Z, \theta)\color{black}}\right) \\
&= \sum_Z q(Z) \log\left(\frac{p(X, Z|\theta)}{p(Z|X, \theta)}\right) \\
&= \sum_Z q(Z) \log\left(\frac{p(X, Z | \theta)}{\color{red}q(Z)\color{black}}\frac{\color{red}q(Z)\color{black}}{p(Z|X, \theta)}\right) \\
&\overset{1}{=} \sum_Z q(Z) \left(\log\left(\frac{p(X, Z|\theta)}{p(Z)}\right) + \log\left(\frac{q(Z)}{p(Z|X, \theta)}\right) \right) \\
&\overset{2}{=} \sum_Z q(Z) \left(\log\left(\frac{p(X, Z|\theta)}{p(Z)}\right) - \log\left(\frac{p(Z|X, \theta)}{q(Z)}\right)\right) \\
&= \sum_Z q(Z) \log\left(\frac{p(X, Z|\theta)}{p(Z)}\right) - \sum_Z q(Z) \log\left(\frac{p(Z|X, \theta)}{q(Z)}\right) \\
&= \mathcal{L}(q, \theta) + \text{KL}(q||p).
\end{aligned}
$$